<!DOCTYPE html>
<html lang="ko">
<head>
    {# head}
    <style>
        /* ì„¹ì…˜ êµ¬ë¶„ ìŠ¤íƒ€ì¼ */
        .form-section {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
            margin: 0 0 20px 0;
            padding-bottom: 12px;
            border-bottom: 2px solid #3b82f6;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: #3b82f6;
            display: inline-block;
        }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ ê°œì„  */
        .btn-select {
            padding: 10px 20px;
            border: 2px solid #3b82f6;
            background: #fff;
            color: #3b82f6;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-select:hover {
            background: #3b82f6;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(59, 130, 246, 0.2);
        }
        
        .btn-select.selected {
            background: #3b82f6;
            color: white;
        }
        
        .btn-select-item {
            padding: 10px 20px;
            border: 2px solid #10b981;
            background: #fff;
            color: #10b981;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-select-item:hover {
            background: #10b981;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.2);
        }
        
        .btn-select-item.selected {
            background: #10b981;
            color: white;
        }
        
        /* ì„ íƒ í‘œì‹œ ì˜ì—­ */
        .selection-display {
            margin-top: 12px;
            padding: 12px;
            background: #f9fafb;
            border: 1px dashed #d1d5db;
            border-radius: 6px;
            min-height: 48px;
            display: flex;
            align-items: center;
        }
        
        .selection-display.has-value {
            background: #eff6ff;
            border-color: #3b82f6;
            border-style: solid;
        }
        
        .selection-placeholder {
            color: #9ca3af;
            font-size: 13px;
        }
        
        /* ìŠ¤ì¼€ì¤„ íƒ­ ìŠ¤íƒ€ì¼ */
        .schedule-tabs {
            display: flex;
            gap: 8px;
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 20px;
        }
        
        .schedule-tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: #f3f4f6;
            color: #6b7280;
            font-weight: 500;
            border-radius: 6px 6px 0 0;
            transition: all 0.2s ease;
        }
        
        .schedule-tab:hover {
            background: #e5e7eb;
            color: #374151;
        }
        
        .schedule-tab.active {
            background: #fff;
            color: #3b82f6;
            box-shadow: 0 -2px 0 #3b82f6 inset;
        }
        
        .schedule-tab-content {
            display: none;
            padding: 20px;
            background: #fff;
        }
        
        .schedule-tab-content.active {
            display: block;
        }
        
        /* ê°€ê²© ë³€ë™ ìƒ‰ìƒ */
        .price-up {
            color: #dc3545;
        }
        
        .price-down {
            color: #28a745;
        }
        
        .price-same {
            color: #6c757d;
        }
        
        /* ì‹œê°„ ì„¤ì • */
        .time-range {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .time-range label {
            margin: 0;
            font-weight: 500;
            color: #374151;
        }
        
        .time-range input[type="time"] {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        
        /* ì²´í¬ë°•ìŠ¤ ê·¸ë£¹ */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.2s;
        }
        
        .checkbox-item:hover {
            background: #f3f4f6;
        }
        
        .checkbox-item input[type="checkbox"] {
            margin: 0;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .checkbox-item label {
            cursor: pointer;
            margin: 0;
        }
        
        /* ì„ íƒëœ í•­ëª© í‘œì‹œ */
        .selected-items {
            margin-top: 10px;
            padding: 10px;
            background: #f3f4f6;
            border-radius: 6px;
        }
        
        .selected-item {
            display: inline-block;
            background: #3b82f6;
            color: white;
            padding: 6px 12px;
            margin: 4px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .selected-item .remove {
            margin-left: 6px;
            cursor: pointer;
            font-weight: bold;
            opacity: 0.8;
        }
        
        .selected-item .remove:hover {
            opacity: 1;
        }
        
        /* ìŠ¤ì¼€ì¤„ ìš”ì•½ */
        .schedule-summary {
            padding: 12px 16px;
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            border-radius: 6px;
            font-size: 14px;
            color: #1e40af;
            font-weight: 500;
            margin-top: 16px;
        }
        
        /* ì €ì¥ ë²„íŠ¼ ì˜ì—­ */
        .action-buttons {
            margin-top: 32px;
            padding-top: 24px;
            border-top: 2px solid #e5e7eb;
        }
    </style>
</head>
<body>
    {# left}
    {# header}
    <main class="container">
        <div role="document">
			<div role="heading" aria-level="1">AI ê¸°ì‚¬ ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì •</div>
			<section>
				<input type="hidden" name="referer" id="referer" value="{ _SERVER['HTTP_REFERER']}"/>
				<form id="inputForm" method="post" role="form">
					<input type="hidden" id="coId" name="coId" value="{? result.item.coId}{result.item.coId}{:}{_SESSION.coId}{/}">
                    <input type="hidden" name="idx" value="{? result.item.idx}{result.item.idx}{:}{/}">
					<input type="hidden" name="action" value="{? result.item.id}update{:}insert{/}">
					<input type="hidden" name="scheduleConfig" id="scheduleConfig" value="">
					
					<!-- 1. ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
					<div class="form-section">
						<h3 class="section-title">ê¸°ë³¸ ì •ë³´</h3>
						
					<div class="grid">
						<label for="title">
                            ìŠ¤ì¼€ì¤„ëŸ¬ ëª…ì¹­<span class="red">*</span>
								<input type="text" placeholder="ì˜ˆ: ë§¤ì¼ ì•„ì¹¨ ì±„ì†Œë¥˜ ê°€ê²© ë™í–¥ ê¸°ì‚¬" name="title" id="title" autocomplete="off" maxlength="60" value="{? !empty(result.item.title)}{result.item.title}{/}">
							<span id="titleResult"></span>
						</label>
					</div>

					<div class="grid">
							<label for="description">
								ì„¤ëª…
								<textarea name="description" id="description" placeholder="ì´ ìŠ¤ì¼€ì¤„ëŸ¬ì˜ ëª©ì ê³¼ ì‹¤í–‰ ë‚´ìš©ì„ ê°„ë‹¨íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”" rows="3">{? !empty(result.item.description)}{result.item.description}{/}</textarea>
							</label>
						</div>
						
						<div class="grid">
							<label for="isUse">
								ì‚¬ìš©ì—¬ë¶€
								<select id="isUse" name="isUse">
									<option value="Y" {? result.item.isUse == true}selected{/}>ì‚¬ìš©</option>
									<option value="N" {? result.item.isUse != true}selected{/}>ë¯¸ì‚¬ìš©</option>
								</select>
							</label>
						</div>
					</div>

					<!-- 3. ë°ì´í„° ì„ íƒ ì„¹ì…˜ -->
					<div class="form-section">
						<h3 class="section-title">ë°ì´í„° ì„ íƒ</h3>
						<p style="color: #6b7280; font-size: 14px; margin-bottom: 20px;">
							ê¸°ì‚¬ì— ì‚¬ìš©í•  ë°ì´í„° ì¹´í…Œê³ ë¦¬, í’ˆëª©, ì¡°íšŒ ê¸°ê°„ì„ ì„ íƒí•˜ì„¸ìš”.
						</p>
						
						<!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ -->
						<div class="grid" style="margin-bottom: 20px;">
						<label>
								ë°ì´í„° ì¹´í…Œê³ ë¦¬<span class="red">*</span>
								<button type="button" class="btn-select {? !empty(result.item.categoryName)}selected{/}" id="selectCategoryBtn">
									<svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
										<path d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5v-3zM2.5 2a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zM1 10.5A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 9h3a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 13.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3z"/>
									</svg>
									ì¹´í…Œê³ ë¦¬ ì„ íƒ
								</button>
								<input type="hidden" id="categoryId" name="categoryId" value="{? !empty(result.item.categoryId)}{result.item.categoryId}{/}">
								<input type="hidden" id="categoryName" name="categoryName" value="{? !empty(result.item.categoryName)}{result.item.categoryName}{/}">
								<div id="selectedCategoryDisplay" class="selection-display {? !empty(result.item.categoryName)}has-value{/}">
									{? !empty(result.item.categoryName)}
									<span class="selected-item">
										{result.item.categoryName}
										<span class="remove" onclick="removeCategorySelection()">Ã—</span>
									</span>
									{:}
									<span class="selection-placeholder">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</span>
									{/}
								</div>
							</label>
						</div>
						
						<!-- í’ˆëª© ì„ íƒ -->
						<div class="grid">
							<label>
								í’ˆëª© ì„ íƒ
								<button type="button" class="btn-select-item {? !empty(result.item.selectedItems)}selected{/}" id="selectItemsBtn">
									<svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
										<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
										<path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
									</svg>
									í’ˆëª© ì„ íƒ
								</button>
							<input type="hidden" id="selectedItems" name="selectedItems" value="">
							<div id="selectedItemsDisplay" class="selection-display">
								<span class="selection-placeholder">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ë©´ í’ˆëª©ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</span>
							</div>
								<div style="margin-top: 8px; font-size: 12px; color: #6b7280; padding: 8px; background: #fef3c7; border-radius: 4px; border-left: 3px solid #f59e0b;">
									ğŸ’¡ í’ˆëª©ì„ ì„ íƒí•˜ì§€ ì•Šìœ¼ë©´ ì¹´í…Œê³ ë¦¬ ë‚´ ë³€ë™í­ì´ í° ìƒìœ„ í’ˆëª©ì´ ìë™ìœ¼ë¡œ ì„ íƒë©ë‹ˆë‹¤
								</div>
							</label>
						</div>
						
						<!-- ë°ì´í„° ì¡°íšŒ ê¸°ê°„ -->
						<div class="grid">
							<label for="dataPeriod">
								ë°ì´í„° ì¡°íšŒ ê¸°ê°„
								<select id="dataPeriod" name="dataPeriod">
									<option value="7" {? result.item.dataPeriod == '7' || empty(result.item.dataPeriod)}selected{/}>1ì£¼ì¼ (ê¸°ë³¸)</option>
									<option value="30" {? result.item.dataPeriod == '30'}selected{/}>1ê°œì›”</option>
									<option value="90" {? result.item.dataPeriod == '90'}selected{/}>3ê°œì›”</option>
									<option value="180" {? result.item.dataPeriod == '180'}selected{/}>6ê°œì›”</option>
									<option value="365" {? result.item.dataPeriod == '365'}selected{/}>1ë…„</option>
								</select>
								<div style="margin-top: 8px; font-size: 12px; color: #6b7280;">
									ğŸ“… ì„ íƒí•œ ê¸°ê°„ì˜ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ AIê°€ ê¸°ì‚¬ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤
								</div>
							</label>
						</div>
					</div>

					<!-- 4. AI ì„¤ì • ì„¹ì…˜ -->
					<div class="form-section">
						<h3 class="section-title">AI ì„¤ì •</h3>
						<p style="color: #6b7280; font-size: 14px; margin-bottom: 20px;">
							AIê°€ ê¸°ì‚¬ë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©í•  í…œí”Œë¦¿ê³¼ í”„ë¡¬í”„íŠ¸ë¥¼ ì„¤ì •í•˜ì„¸ìš”.
						</p>
						
						<!-- ê¸°ì‚¬ í…œí”Œë¦¿ -->
						<div class="grid">
							<label for="templateId">
								ê¸°ì‚¬ í…œí”Œë¦¿<span class="red">*</span>
								<select id="templateId" name="templateId">
									<option value="">ê¸°ì‚¬ í…œí”Œë¦¿ì„ ì„ íƒí•˜ì„¸ìš”</option>
									{@ result.template}
									<option value="{.idx}" {? result.item.templateId == .idx}selected{/}>{.subject}</option>
									{/}
								</select>
							</label>
						</div>

						<!-- í”„ë¡¬í”„íŠ¸ -->
						<div class="grid">
							<label for="promptId">
								í”„ë¡¬í”„íŠ¸<span class="red">*</span>
								<select id="promptId" name="promptId">
									<option value="">í”„ë¡¬í”„íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
									{@ result.prompt}
									<option value="{.idx}" {? result.item.promptId == .idx}selected{/}>{.title}</option>
									{/}
								</select>
							</label>
						</div>

						<!-- ì´ë¯¸ì§€/ì°¨íŠ¸ ìƒì„± ì˜µì…˜ -->
						<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
							<div class="grid">
								<label for="makeImage">
									ì´ë¯¸ì§€ ìƒì„±
									<select id="makeImage" name="makeImage">
										<option value="generate" {? result.item.makeImage == 'generate' || empty(result.item.makeImage)}selected{/}>ìƒì„±</option>
										<option value="no-generate" {? result.item.makeImage == 'no-generate'}selected{/}>ìƒì„±ì•ˆí•¨</option>
									</select>
								</label>
							</div>
						</div>
					</div>

                    <!-- 2. ìŠ¤ì¼€ì¤„ ì„¤ì • ì„¹ì…˜ -->
					<div class="form-section">
						<h3 class="section-title">ìŠ¤ì¼€ì¤„ ì„¤ì •</h3>						<p style="color: #6b7280; font-size: 14px; margin-bottom: 20px;">
							ê¸°ì‚¬ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•  ì£¼ê¸°ì™€ ì‹œê°„ì„ ì„¤ì •í•˜ì„¸ìš”.
						</p>
						
                            <div class="schedule-tabs">
                                <div class="schedule-tab active" data-type="daily">ì¼ê°„</div>
                                <div class="schedule-tab" data-type="weekly">ì£¼ê°„</div>
                                <div class="schedule-tab" data-type="monthly">ì›”ê°„</div>
                                <div class="schedule-tab" data-type="quarterly">ë¶„ê¸°</div>
                                <div class="schedule-tab" data-type="yearly">ë…„ê°„</div>
                            </div>
                            
                            <!-- ì¼ê°„ íƒ­ -->
                            <div class="schedule-tab-content active" id="daily-content">
                                <p>ë§¤ì¼ ì§€ì •ëœ ì‹œê°„ì— 1íšŒ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>
                                <div class="time-range">
                                    <label>ì‹¤í–‰ ì‹œê°„: <input type="time" name="dailyTime" id="dailyTime" value="{? result.item.scheduleConfig.daily.time}{result.item.scheduleConfig.daily.time}{:}09:00{/}"></label>
                                </div>
                                <div class="schedule-summary" id="daily-summary">
                                    ë§¤ì¼ 09:00ì— ì‹¤í–‰ë©ë‹ˆë‹¤.
                                </div>
                            </div>
                            
                            <!-- ì£¼ê°„ íƒ­ -->
                            <div class="schedule-tab-content" id="weekly-content">
                                <p>ì„ íƒí•œ ìš”ì¼ì— 1íšŒ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>
                                <div class="checkbox-group">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="weekly-1" value="1" name="weeklyDays[]">
                                        <label for="weekly-1">ì›”ìš”ì¼</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="weekly-2" value="2" name="weeklyDays[]">
                                        <label for="weekly-2">í™”ìš”ì¼</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="weekly-3" value="3" name="weeklyDays[]">
                                        <label for="weekly-3">ìˆ˜ìš”ì¼</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="weekly-4" value="4" name="weeklyDays[]">
                                        <label for="weekly-4">ëª©ìš”ì¼</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="weekly-5" value="5" name="weeklyDays[]">
                                        <label for="weekly-5">ê¸ˆìš”ì¼</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="weekly-6" value="6" name="weeklyDays[]">
                                        <label for="weekly-6">í† ìš”ì¼</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="weekly-0" value="0" name="weeklyDays[]">
                                        <label for="weekly-0">ì¼ìš”ì¼</label>
                                    </div>
                                </div>
                                <div class="time-range" style="margin-top: 20px;">
                                    <label>ì‹¤í–‰ ì‹œê°„: <input type="time" name="weeklyTime" id="weeklyTime" value="{? result.item.scheduleConfig.weekly.time}{result.item.scheduleConfig.weekly.time}{:}09:00{/}"></label>
                                </div>
                                <div class="selected-items" id="weekly-selected" style="display: none;">
                                    <strong>ì„ íƒëœ ìš”ì¼:</strong> <span id="weekly-selected-text"></span>
                                </div>
                                <div class="schedule-summary" id="weekly-summary">
                                    ì„ íƒëœ ìš”ì¼ 09:00ì— ì‹¤í–‰ë©ë‹ˆë‹¤.
                                </div>
                            </div>
                            
                            <!-- ì›”ê°„ íƒ­ -->
                            <div class="schedule-tab-content" id="monthly-content">
                                <p>ë§¤ì›” ì„ íƒí•œ ì¼ìì— 1íšŒ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>
                                <div class="checkbox-group">
                                    <!-- 1ì¼ë¶€í„° 31ì¼ê¹Œì§€ ì²´í¬ë°•ìŠ¤ ìƒì„± -->
                                </div>
                                <div class="time-range" style="margin-top: 20px;">
                                    <label>ì‹¤í–‰ ì‹œê°„: <input type="time" name="monthlyTime" id="monthlyTime" value="{? result.item.scheduleConfig.monthly.time}{result.item.scheduleConfig.monthly.time}{:}09:00{/}"></label>
                                </div>
                                <div class="selected-items" id="monthly-selected" style="display: none;">
                                    <strong>ì„ íƒëœ ì¼ì:</strong> <span id="monthly-selected-text"></span>
                                </div>
                                <div class="schedule-summary" id="monthly-summary">
                                    ë§¤ì›” ì„ íƒëœ ì¼ì 09:00ì— ì‹¤í–‰ë©ë‹ˆë‹¤.
                                </div>
                            </div>
                            
                            <!-- ë¶„ê¸° íƒ­ -->
                            <div class="schedule-tab-content" id="quarterly-content">
                                <p>ì„ íƒí•œ ë¶„ê¸° ì²«ë‚ ì— 1íšŒ ì‹¤í–‰ë©ë‹ˆë‹¤. (1ì›”1ì¼, 4ì›”1ì¼, 7ì›”1ì¼, 10ì›”1ì¼)</p>
                                <div class="checkbox-group">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="quarterly-1" value="1" name="quarterlyMonths[]">
                                        <label for="quarterly-1">1ë¶„ê¸° (1ì›”1ì¼)</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="quarterly-2" value="2" name="quarterlyMonths[]">
                                        <label for="quarterly-2">2ë¶„ê¸° (4ì›”1ì¼)</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="quarterly-3" value="3" name="quarterlyMonths[]">
                                        <label for="quarterly-3">3ë¶„ê¸° (7ì›”1ì¼)</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="quarterly-4" value="4" name="quarterlyMonths[]">
                                        <label for="quarterly-4">4ë¶„ê¸° (10ì›”1ì¼)</label>
                                    </div>
                                </div>
                                <div class="time-range" style="margin-top: 20px;">
                                    <label>ì‹¤í–‰ ì‹œê°„: <input type="time" name="quarterlyTime" id="quarterlyTime" value="{? result.item.scheduleConfig.quarterly.time}{result.item.scheduleConfig.quarterly.time}{:}09:00{/}"></label>
                                </div>
                                <div class="selected-items" id="quarterly-selected" style="display: none;">
                                    <strong>ì„ íƒëœ ë¶„ê¸°:</strong> <span id="quarterly-selected-text"></span>
                                </div>
                                <div class="schedule-summary" id="quarterly-summary">
                                    ì„ íƒëœ ë¶„ê¸° ì²«ë‚  09:00ì— ì‹¤í–‰ë©ë‹ˆë‹¤.
                                </div>
                            </div>
                            
                            <!-- ë…„ê°„ íƒ­ -->
                            <div class="schedule-tab-content" id="yearly-content">
                                <p>ë§¤ë…„ ì„ íƒí•œ ì›” 1ì¼ì— 1íšŒ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>
                                <div class="checkbox-group">
                                    <!-- 1ì›”ë¶€í„° 12ì›”ê¹Œì§€ ì²´í¬ë°•ìŠ¤ ìƒì„± -->
                                </div>
                                <div class="time-range" style="margin-top: 20px;">
                                    <label>ì‹¤í–‰ ì‹œê°„: <input type="time" name="yearlyTime" id="yearlyTime" value="{? result.item.scheduleConfig.yearly.time}{result.item.scheduleConfig.yearly.time}{:}09:00{/}"></label>
                                </div>
                                <div class="selected-items" id="yearly-selected" style="display: none;">
                                    <strong>ì„ íƒëœ ì›”:</strong> <span id="yearly-selected-text"></span>
                                </div>
                                <div class="schedule-summary" id="yearly-summary">
                                    ë§¤ë…„ ì„ íƒëœ ì›” 1ì¼ 09:00ì— ì‹¤í–‰ë©ë‹ˆë‹¤.
                                </div>
                            </div>
					</div>
				</form>

			<!-- ì €ì¥ ë²„íŠ¼ ì˜ì—­ -->
			<div class="action-buttons">
				<div class="flex justify-center" style="gap: 12px;">
					<button type="button" class="btn btn-md" id="saveBtn" style="background: #3b82f6; min-width: 150px;">
						ìŠ¤ì¼€ì¤„ ì €ì¥
					</button>
					{? !empty(_GET["idx"])}
					<button type="button" class="btn btn-md" id="deleteBtn" style="background: #ef4444; min-width: 150px;">
						ì‚­ì œ
					</button>
					{/}
					<button type="button" class="btn btn-md" id="listBtn" style="background: #6b7280; min-width: 150px;">
						ëª©ë¡ìœ¼ë¡œ
					</button>
				</div>
			</div>
			</section>
		</div>
	</main>

<script type="text/javascript">
// ì „ì—­ ë³€ìˆ˜
var action = '{? empty(_GET["idx"])}Insert{:}Modify{/}';
var currentScheduleType = 'daily';
var selectedItemsData = []; // ì„ íƒëœ í’ˆëª© ë°ì´í„°
var availableItems = []; // ì¹´í…Œê³ ë¦¬ë³„ ì „ì²´ í’ˆëª© ë¦¬ìŠ¤íŠ¸

// PHPì—ì„œ ì „ë‹¬ë°›ì€ ì €ì¥ëœ í’ˆëª© ë°ì´í„° (ìˆ˜ì • ëª¨ë“œ)
var savedSelectedItems = {? !empty(result.item.selectedItems)}{=json_encode(result.item.selectedItems)}{:}null{/};

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
$(document).ready(function() {
    if(action === 'Modify') {
        $("#saveBtn").text('ìŠ¤ì¼€ì¤„ ìˆ˜ì •');
    }
    
    // ì›”ê°„ ì²´í¬ë°•ìŠ¤ ìƒì„±
    generateMonthlyCheckboxes();
    
    // ë…„ê°„ ì²´í¬ë°•ìŠ¤ ìƒì„±
    generateYearlyCheckboxes();

    // ì´ë²¤íŠ¸ ë°”ì¸ë”©
    bindEvents();
    
    // ì¹´í…Œê³ ë¦¬ ì„ íƒ ë²„íŠ¼ ì´ë²¤íŠ¸
    $('#selectCategoryBtn').click(function(){
        openCategoryPopup();
    });
    
    // í’ˆëª© ì„ íƒ ë²„íŠ¼ ì´ë²¤íŠ¸
    $('#selectItemsBtn').click(function(){
        if(!$('#categoryId').val()){
            alert('ë¨¼ì € ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }
        showItemSelectionModal();
    });
    
    // ë°ì´í„° ê¸°ê°„ ì„ íƒ ë³€ê²½ ì´ë²¤íŠ¸
    $('#dataPeriod').change(function(){
        var categoryId = $('#categoryId').val();
        if(categoryId){
            // ì¹´í…Œê³ ë¦¬ê°€ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ í’ˆëª© ë°ì´í„° ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸°
            fetchItemsByCategory(categoryId);
        }
    });
    
    // íŒì—…ì—ì„œ ì¹´í…Œê³ ë¦¬ ì„ íƒ ë©”ì‹œì§€ ìˆ˜ì‹ 
    window.addEventListener('message', function(event) {
        // ë³´ì•ˆ: ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë„ë©”ì¸ì—ì„œ ì˜¨ ë©”ì‹œì§€ì¸ì§€ í™•ì¸
        // ê°œë°œ í™˜ê²½ì—ì„œëŠ” ëª¨ë“  origin í—ˆìš©, í”„ë¡œë•ì…˜ì—ì„œëŠ” íŠ¹ì • ë„ë©”ì¸ë§Œ í—ˆìš©
        // if (event.origin !== "https://datacms.hankyung.com") return;
        
        if (event.data.type === 'fromCategory') {
            // ì¹´í…Œê³ ë¦¬ íŒì—…ì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„°
            var categories = event.data.result;
            
            if (categories && categories.length > 0) {
                // ì²« ë²ˆì§¸ ì¹´í…Œê³ ë¦¬ë§Œ ì‚¬ìš© (ìŠ¤ì¼€ì¤„ëŸ¬ëŠ” ë‹¨ì¼ ì¹´í…Œê³ ë¦¬)
                var category = categories[0];
                
                // selectCategory í•¨ìˆ˜ í˜¸ì¶œ
                selectCategory(categories);
            }
        }
    });
    
    // ìˆ˜ì • ëª¨ë“œì¼ ë•Œ ê¸°ì¡´ ë°ì´í„° ë¡œë“œ
    if(action === 'Modify'){
        loadScheduleData();
        
        // ì¹´í…Œê³ ë¦¬ê°€ ìˆìœ¼ë©´ í’ˆëª© ë°ì´í„° ë¡œë“œ
        var categoryId = $('#categoryId').val();
        var categoryName = $('#categoryName').val();
        
        if(categoryId && categoryName){
            // ì¹´í…Œê³ ë¦¬ UIëŠ” ì´ë¯¸ HTML í…œí”Œë¦¿ì—ì„œ ì„¤ì •ë˜ì–´ ìˆìŒ
            // í’ˆëª© API ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„ ì €ì¥ëœ í’ˆëª© ë¡œë“œ
            fetchItemsByCategory(categoryId, function(){
                console.log('API í’ˆëª© ë¡œë“œ ì™„ë£Œ, ì €ì¥ëœ í’ˆëª© í‘œì‹œ ì‹œì‘');
                loadSelectedItems();
            });
        } else {
            // ì¹´í…Œê³ ë¦¬ê°€ ì—†ì–´ë„ í’ˆëª© ë°ì´í„°ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë¡œë“œ ì‹œë„
            loadSelectedItems();
        }
    }
    
    // ì´ˆê¸° ìŠ¤ì¼€ì¤„ ìš”ì•½ ì—…ë°ì´íŠ¸
    updateScheduleSummary();
});

// ê¸°ì¡´ ìŠ¤ì¼€ì¤„ ë°ì´í„° ë¡œë“œ (ìˆ˜ì • ëª¨ë“œ)
function loadScheduleData(){
    var scheduleConfigStr = '{? !empty(result.item.scheduleConfig)}{=json_encode(result.item.scheduleConfig)}{/}';
    
    if(!scheduleConfigStr){
        return;
    }
    
    try {
        var scheduleConfig = JSON.parse(scheduleConfigStr);
        
        if(scheduleConfig.type){
            currentScheduleType = scheduleConfig.type;
            switchTab(scheduleConfig.type);
        }
        
        // ì£¼ê°„ ìš”ì¼ ì²´í¬
        if(scheduleConfig.weekly && scheduleConfig.weekly.days){
            scheduleConfig.weekly.days.forEach(function(day){
                $('#weekly-' + day).prop('checked', true);
            });
            updateSelectedDisplay('weekly');
        }
        
        // ì›”ê°„ ì¼ì ì²´í¬ (datesë¡œ ë³€ê²½)
        if(scheduleConfig.monthly && scheduleConfig.monthly.dates){
            scheduleConfig.monthly.dates.forEach(function(date){
                $('#monthly-' + date).prop('checked', true);
            });
            updateSelectedDisplay('monthly');
        }
        
        // í•˜ìœ„ í˜¸í™˜ì„±: ê¸°ì¡´ days í˜•ì‹ë„ ì§€ì› (í–¥í›„ ì œê±° ê°€ëŠ¥)
        else if(scheduleConfig.monthly && scheduleConfig.monthly.days){
            scheduleConfig.monthly.days.forEach(function(day){
                $('#monthly-' + day).prop('checked', true);
            });
            updateSelectedDisplay('monthly');
        }
        
        // ë¶„ê¸° ì²´í¬
        if(scheduleConfig.quarterly && scheduleConfig.quarterly.quarters){
            scheduleConfig.quarterly.quarters.forEach(function(quarter){
                $('#quarterly-' + quarter).prop('checked', true);
            });
            updateSelectedDisplay('quarterly');
        }
        
        // ë…„ê°„ ì›” ì²´í¬
        if(scheduleConfig.yearly && scheduleConfig.yearly.months){
            scheduleConfig.yearly.months.forEach(function(month){
                $('#yearly-' + month).prop('checked', true);
            });
            updateSelectedDisplay('yearly');
        }
        
    } catch(e) {
        console.error('ìŠ¤ì¼€ì¤„ ì„¤ì • ë¡œë“œ ì˜¤ë¥˜:', e);
    }
}

// ì›”ê°„ ì²´í¬ë°•ìŠ¤ ìƒì„±
function generateMonthlyCheckboxes() {
    var container = $('#monthly-content .checkbox-group');
    container.empty();
    
    for(var i = 1; i <= 31; i++) {
        var item = $('<div class="checkbox-item">' +
            '<input type="checkbox" id="monthly-' + i + '" value="' + i + '" name="monthlyDays[]">' +
            '<label for="monthly-' + i + '">' + i + 'ì¼</label>' +
            '</div>');
        container.append(item);
    }
}

// ë…„ê°„ ì²´í¬ë°•ìŠ¤ ìƒì„±
function generateYearlyCheckboxes() {
    var container = $('#yearly-content .checkbox-group');
    container.empty();
    
    for(var i = 1; i <= 12; i++) {
        var item = $('<div class="checkbox-item">' +
            '<input type="checkbox" id="yearly-' + i + '" value="' + i + '" name="yearlyMonths[]">' +
            '<label for="yearly-' + i + '">' + i + 'ì›”</label>' +
            '</div>');
        container.append(item);
    }
}


// ì´ë²¤íŠ¸ ë°”ì¸ë”©
function bindEvents() {
    // íƒ­ í´ë¦­ ì´ë²¤íŠ¸
    $('.schedule-tab').click(function() {
        var type = $(this).data('type');
        switchTab(type);
    });
    
    // ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì´ë²¤íŠ¸
    $('input[type="checkbox"]').change(function() {
        var type = $(this).closest('.schedule-tab-content').attr('id').replace('-content', '');
        updateSelectedDisplay(type);
        updateScheduleSummary();
    });
    
    // ì‹œê°„ ë³€ê²½ ì´ë²¤íŠ¸
    $('input[type="time"]').change(function() {
        updateScheduleSummary();
    });
}

// íƒ­ ì „í™˜
function switchTab(type) {
    currentScheduleType = type;
    
    // íƒ­ í™œì„±í™”
    $('.schedule-tab').removeClass('active');
    $('.schedule-tab[data-type="' + type + '"]').addClass('active');
    
    // ì»¨í…ì¸  í™œì„±í™”
    $('.schedule-tab-content').removeClass('active');
    $('#' + type + '-content').addClass('active');
    
    // ìŠ¤ì¼€ì¤„ ìš”ì•½ ì—…ë°ì´íŠ¸
    updateScheduleSummary();
}

// ì„ íƒëœ í•­ëª© í‘œì‹œ ì—…ë°ì´íŠ¸
function updateSelectedDisplay(type) {
    var selectedItems = [];
    var container = $('#' + type + '-content');
    
    container.find('input[type="checkbox"]:checked').each(function() {
        var value = $(this).val();
        var label = $(this).next('label').text();
        selectedItems.push({value: value, text: label});
    });
    
    var selectedContainer = $('#' + type + '-selected');
    var selectedText = $('#' + type + '-selected-text');
    
    if(selectedItems.length > 0) {
        selectedText.empty();
        selectedItems.forEach(function(item) {
            selectedText.append('<span class="selected-item">' + item.text + '</span>');
        });
        selectedContainer.show();
    } else {
        selectedContainer.hide();
    }
}

// ìŠ¤ì¼€ì¤„ ìš”ì•½ ì—…ë°ì´íŠ¸
function updateScheduleSummary() {
    var summary = '';
    var time = $('#' + currentScheduleType + 'Time').val() || '09:00';
    
    switch(currentScheduleType) {
        case 'daily':
            summary = 'ë§¤ì¼ ' + time + 'ì— ì‹¤í–‰ë©ë‹ˆë‹¤.';
            break;
        case 'weekly':
            var selectedDays = [];
            $('#weekly-content input[type="checkbox"]:checked').each(function() {
                selectedDays.push($(this).next('label').text());
            });
            if(selectedDays.length > 0) {
                summary = selectedDays.join(', ') + ' ' + time + 'ì— ì‹¤í–‰ë©ë‹ˆë‹¤.';
            } else {
                summary = 'ì„ íƒëœ ìš”ì¼ ' + time + 'ì— ì‹¤í–‰ë©ë‹ˆë‹¤.';
            }
            break;
        case 'monthly':
            var selectedDays = [];
            $('#monthly-content input[type="checkbox"]:checked').each(function() {
                selectedDays.push($(this).next('label').text());
            });
            if(selectedDays.length > 0) {
                summary = 'ë§¤ì›” ' + selectedDays.join(', ') + ' ' + time + 'ì— ì‹¤í–‰ë©ë‹ˆë‹¤.';
            } else {
                summary = 'ë§¤ì›” ì„ íƒëœ ì¼ì ' + time + 'ì— ì‹¤í–‰ë©ë‹ˆë‹¤.';
            }
            break;
        case 'quarterly':
            var selectedQuarters = [];
            $('#quarterly-content input[type="checkbox"]:checked').each(function() {
                selectedQuarters.push($(this).next('label').text());
            });
            if(selectedQuarters.length > 0) {
                summary = selectedQuarters.join(', ') + ' ' + time + 'ì— ì‹¤í–‰ë©ë‹ˆë‹¤.';
            } else {
                summary = 'ì„ íƒëœ ë¶„ê¸° ì²«ë‚  ' + time + 'ì— ì‹¤í–‰ë©ë‹ˆë‹¤.';
            }
            break;
        case 'yearly':
            var selectedMonths = [];
            $('#yearly-content input[type="checkbox"]:checked').each(function() {
                selectedMonths.push($(this).next('label').text());
            });
            if(selectedMonths.length > 0) {
                summary = 'ë§¤ë…„ ' + selectedMonths.join(', ') + ' 1ì¼ ' + time + 'ì— ì‹¤í–‰ë©ë‹ˆë‹¤.';
            } else {
                summary = 'ë§¤ë…„ ì„ íƒëœ ì›” 1ì¼ ' + time + 'ì— ì‹¤í–‰ë©ë‹ˆë‹¤.';
            }
            break;
    }
    
    $('#' + currentScheduleType + '-summary').text(summary);
}

// ëª½ê³ DBìš© ìŠ¤ì¼€ì¤„ ì„¤ì • JSON ìƒì„± (ì„ íƒëœ íƒ­ë§Œ ì €ì¥)
function generateScheduleConfig() {
    var config = {
        type: currentScheduleType
    };
    
    // ì„ íƒëœ íƒ­ì˜ ì„¤ì •ë§Œ ì €ì¥
    switch(currentScheduleType) {
        case 'daily':
    config.daily = {
                time: $('#dailyTime').val() || '09:00'
    };
            break;
    
        case 'weekly':
    var weeklyDays = [];
    $('#weekly-content input[type="checkbox"]:checked').each(function() {
        weeklyDays.push(parseInt($(this).val()));
    });
    config.weekly = {
        days: weeklyDays,
                time: $('#weeklyTime').val() || '09:00'
    };
            break;
    
        case 'monthly':
    var monthlyDates = [];
    $('#monthly-content input[type="checkbox"]:checked').each(function() {
        monthlyDates.push(parseInt($(this).val()));
    });
    config.monthly = {
        dates: monthlyDates,  // days â†’ datesë¡œ ë³€ê²½ (ë‚ ì§œë¥¼ ì˜ë¯¸)
                time: $('#monthlyTime').val() || '09:00'
    };
            break;
    
        case 'quarterly':
    var quarterlyQuarters = [];
    $('#quarterly-content input[type="checkbox"]:checked').each(function() {
        quarterlyQuarters.push(parseInt($(this).val()));
    });
    config.quarterly = {
        quarters: quarterlyQuarters,
                time: $('#quarterlyTime').val() || '09:00'
    };
            break;
    
        case 'yearly':
    var yearlyMonths = [];
    $('#yearly-content input[type="checkbox"]:checked').each(function() {
        yearlyMonths.push(parseInt($(this).val()));
    });
    config.yearly = {
        months: yearlyMonths,
                time: $('#yearlyTime').val() || '09:00'
    };
            break;
    }
    
    return config;
}

// ì €ì¥ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
$("#saveBtn").click(function (){
    // í•„ìˆ˜ í•„ë“œ ê²€ì¦
    if($('#title').val().trim() == ''){
        alert('ìŠ¤ì¼€ì¤„ëŸ¬ ëª…ì¹­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        $('#title').focus();
        return;
    }
    
    if($('#templateId').val() == ''){
        alert('ê¸°ì‚¬ í…œí”Œë¦¿ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        $('#templateId').focus();
        return;
    }
    
    if($('#promptId').val() == ''){
        alert('í”„ë¡¬í”„íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        $('#promptId').focus();
        return;
    }
    
    if($('#categoryId').val() == ''){
        alert('ë°ì´í„° ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        $('#categoryId').focus();
        return;
    }
    
    // ìŠ¤ì¼€ì¤„ íƒ€ì…ë³„ ê²€ì¦
    if(!validateScheduleSettings()){
        return;
    }

    // ëª½ê³ DBìš© ìŠ¤ì¼€ì¤„ ì„¤ì • JSON ìƒì„±
    var scheduleConfig = generateScheduleConfig();
    $('#scheduleConfig').val(JSON.stringify(scheduleConfig));

    // AJAX ìš”ì²­
    $.ajax({
        url: '/aiSetting/schedule' + action + '/ajax',
        method : 'POST',
        data : $('#inputForm').serialize(),
        dataType: 'json'
    }).done(function(response) {
        // ë¬¸ìì—´ë¡œ ë“¤ì–´ì˜¨ ê²½ìš° JSON íŒŒì‹±
        if(typeof response === 'string'){
            try {
                response = JSON.parse(response);
            } catch(e) {
                console.error('JSON íŒŒì‹± ì˜¤ë¥˜:', e);
                alert('ì„œë²„ ì‘ë‹µ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                return;
            }
        }
        
        if(response.result.success) {
            alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            goList();
        } else {
            alert(response.message || 'ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }).fail(function(jqXHR, textStatus, errorThrown) {
        console.error('AJAX ì˜¤ë¥˜:', textStatus, errorThrown);
        console.error('ì‘ë‹µ:', jqXHR.responseText);
        alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
});

// ìŠ¤ì¼€ì¤„ ì„¤ì • ê²€ì¦
function validateScheduleSettings() {
    var currentContent = $('#' + currentScheduleType + '-content');
    
    switch(currentScheduleType) {
        case 'daily':
            if(!$('#dailyTime').val()) {
                alert('ì‹¤í–‰ ì‹œê°„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                $('#dailyTime').focus();
                return false;
            }
            break;
        case 'weekly':
            if(currentContent.find('input[type="checkbox"]:checked').length === 0) {
                alert('ìµœì†Œ í•˜ë‚˜ì˜ ìš”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return false;
            }
            if(!$('#weeklyTime').val()) {
                alert('ì‹¤í–‰ ì‹œê°„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                $('#weeklyTime').focus();
                return false;
            }
            break;
        case 'monthly':
            if(currentContent.find('input[type="checkbox"]:checked').length === 0) {
                alert('ìµœì†Œ í•˜ë‚˜ì˜ ì¼ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return false;
            }
            if(!$('#monthlyTime').val()) {
                alert('ì‹¤í–‰ ì‹œê°„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                $('#monthlyTime').focus();
                return false;
            }
            break;
        case 'quarterly':
            if(currentContent.find('input[type="checkbox"]:checked').length === 0) {
                alert('ìµœì†Œ í•˜ë‚˜ì˜ ë¶„ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return false;
            }
            if(!$('#quarterlyTime').val()) {
                alert('ì‹¤í–‰ ì‹œê°„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                $('#quarterlyTime').focus();
                return false;
            }
            break;
        case 'yearly':
            if(currentContent.find('input[type="checkbox"]:checked').length === 0) {
                alert('ìµœì†Œ í•˜ë‚˜ì˜ ì›”ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return false;
            }
            if(!$('#yearlyTime').val()) {
                alert('ì‹¤í–‰ ì‹œê°„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                $('#yearlyTime').focus();
                return false;
            }
            break;
    }
    
    return true;
}

// ëª©ë¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
$("#listBtn").click(function(){
    goList();
});

// ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
$("#deleteBtn").click(function(){
    if(!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ìŠ¤ì¼€ì¤„ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
        return;
    }
    
    var idx = '{? !empty(_GET["idx"])}{=_GET["idx"]}{/}';
    if(!idx) {
        alert('ì‚­ì œí•  ìŠ¤ì¼€ì¤„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    $.ajax({
        url: '/aiSetting/scheduleDelete/ajax',
        method: 'POST',
        data: { idx: idx },
        dataType: 'json'
    }).done(function(response) {
        // ë¬¸ìì—´ë¡œ ë“¤ì–´ì˜¨ ê²½ìš° JSON íŒŒì‹±
        if(typeof response === 'string'){
            try {
                response = JSON.parse(response);
            } catch(e) {
                console.error('JSON íŒŒì‹± ì˜¤ë¥˜:', e);
                alert('ì„œë²„ ì‘ë‹µ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                return;
            }
        }
        
        if(response.result.success) {
            alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            goList();
        } else {
            alert(response.result.message || 'ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }).fail(function(jqXHR, textStatus, errorThrown) {
        console.error('AJAX ì˜¤ë¥˜:', textStatus, errorThrown);
        console.error('ì‘ë‹µ:', jqXHR.responseText);
        alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
});

// ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë¡œ ì´ë™
function goList() {
    location.href = '/aiSetting/scheduleList';
}

// ============================================
// ì¹´í…Œê³ ë¦¬ ê´€ë ¨ í•¨ìˆ˜
// ============================================

// ì¹´í…Œê³ ë¦¬ íŒì—… ì—´ê¸°
function openCategoryPopup() {
    var popupWidth = 1000;
    var popupHeight = 700;
    var left = (window.screen.width - popupWidth) / 2;
    var top = (window.screen.height - popupHeight) / 2;
    
    // ì„ íƒ ê°€ëŠ¥í•œ ì¹´í…Œê³ ë¦¬ ê°œìˆ˜ ì„¤ì • (ê¸°ë³¸ê°’: 1ê°œ, ìŠ¤ì¼€ì¤„ëŸ¬ëŠ” ë‹¨ì¼ ì¹´í…Œê³ ë¦¬ë§Œ ì„ íƒ)
    var maxSelections = 1;
    
    var popup = window.open(
        '/category/popup?maxSelections=' + maxSelections,
        'categoryPopup',
        'width=' + popupWidth + ',height=' + popupHeight + ',left=' + left + ',top=' + top + ',scrollbars=yes,resizable=yes'
    );
    
    if (popup) {
        popup.focus();
    } else {
        alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—… ì°¨ë‹¨ì„ í•´ì œí•´ì£¼ì„¸ìš”.');
    }
}

// ì¹´í…Œê³ ë¦¬ ì„ íƒ ì½œë°± (íŒì—…ì—ì„œ í˜¸ì¶œ)
function selectCategory(categories) {
    if (!categories || categories.length === 0) {
        return;
    }
    
    // ì²« ë²ˆì§¸ ì¹´í…Œê³ ë¦¬ë§Œ ì‚¬ìš© (ìŠ¤ì¼€ì¤„ëŸ¬ëŠ” ë‹¨ì¼ ì¹´í…Œê³ ë¦¬)
    var category = categories[0];
    
    $('#categoryId').val(category.id);
    $('#categoryName').val(category.name);
    
    updateCategoryDisplay(category);
    
    // ì¹´í…Œê³ ë¦¬ ë³€ê²½ ì‹œ í’ˆëª© ë°ì´í„° ë¡œë“œ
    fetchItemsByCategory(category.id);
}

// ì¹´í…Œê³ ë¦¬ í‘œì‹œ ì—…ë°ì´íŠ¸
function updateCategoryDisplay(category) {
    var display = $('#selectedCategoryDisplay');
    display.empty();
    
    if (category && category.id) {
        display.addClass('has-value');
        $('#selectCategoryBtn').addClass('selected');
        
        var tag = $('<span class="selected-item"></span>');
        tag.text(category.name);
        
        var removeBtn = $('<span class="remove">Ã—</span>');
        removeBtn.click(function(){
            removeCategorySelection();
        });
        
        tag.append(removeBtn);
        display.append(tag);
    } else {
        display.removeClass('has-value');
        $('#selectCategoryBtn').removeClass('selected');
        display.html('<span class="selection-placeholder">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</span>');
    }
}

// ì¹´í…Œê³ ë¦¬ ì„ íƒ ì œê±°
function removeCategorySelection() {
    $('#categoryId').val('');
    $('#categoryName').val('');
    selectedItemsData = [];
    availableItems = [];
    updateCategoryDisplay(null);
    updateSelectedItemsDisplay();
}

// ============================================
// í’ˆëª© ê´€ë ¨ í•¨ìˆ˜
// ============================================

// ë‚ ì§œ ê³„ì‚° (nì¼ ì „)
function getDateBefore(days) {
    var date = new Date();
    date.setDate(date.getDate() - days);
    return date.getFullYear() + '-' + 
           String(date.getMonth() + 1).padStart(2, '0') + '-' + 
           String(date.getDate()).padStart(2, '0');
}

// ì¹´í…Œê³ ë¦¬ë³„ í’ˆëª© ê°€ì ¸ì˜¤ê¸°
function fetchItemsByCategory(categoryId, callback){
    try {
        // ì„ íƒëœ ê¸°ê°„ ê°€ì ¸ì˜¤ê¸° (ê¸°ë³¸ê°’: 7ì¼)
        var period = parseInt($('#dataPeriod').val()) || 7;
        var startDate = getDateBefore(period);
        var url = 'https://price-api.hankyung.com/api/data?categoryId=' + encodeURIComponent(categoryId) + 
                  '&startDate=' + startDate + '&sortField=prevDayChange&sortOrder=desc';
        
        $.ajax({
            url: url,
            method: 'GET',
            dataType: 'json'
        }).done(function(json){
            var rawList = [];
            if (json && json.data && Array.isArray(json.data.data)) {
                rawList = json.data.data;
            } else if (Array.isArray(json && json.data)) {
                rawList = json.data;
            } else if (Array.isArray(json)) {
                rawList = json;
            }
            
            availableItems = rawList.map(function(v){
                return {
                    id: v.sid || v.id || '',
                    title: v.name || v.title || v.sid || '',
                    kind: (v.data && v.data[0] && v.data[0].kind) || '',
                    grade: (v.data && v.data[0] && v.data[0].grade) || '',
                    price: (v.data && v.data[0] && v.data[0].price) || '',
                    prevDayPrice: (v.data && v.data[0] && v.data[0].prevDayPrice) || ''
                };
            }).filter(function(item){ return item.id && item.title; });
            
            if (availableItems.length === 0) {
                alert('í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ í’ˆëª© ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('í’ˆëª© ' + availableItems.length + 'ê°œ ë¡œë“œ ì™„ë£Œ');
            
            // ì½œë°± ì‹¤í–‰
            if(typeof callback === 'function'){
                callback();
            }
            
        }).fail(function(error){
            console.error('í’ˆëª© ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
            alert('í’ˆëª© ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
        
    } catch(e) {
        console.error('fetchItemsByCategory error', e);
        alert('í’ˆëª© ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
}

// ì„ íƒëœ í’ˆëª© í‘œì‹œ ì—…ë°ì´íŠ¸
function updateSelectedItemsDisplay(){
    var display = $('#selectedItemsDisplay');
    display.empty();
    
    if(selectedItemsData.length === 0){
        display.removeClass('has-value');
        $('#selectItemsBtn').removeClass('selected');
        display.html('<span class="selection-placeholder">ì„ íƒëœ í’ˆëª©ì´ ì—†ìŠµë‹ˆë‹¤ (ìë™ ì„ íƒë¨)</span>');
        $('#selectedItems').val('');
        return;
    }
    
    display.addClass('has-value');
    $('#selectItemsBtn').addClass('selected');
    
    selectedItemsData.forEach(function(item){
        var tag = $('<span class="selected-item"></span>');
        tag.text(item.title + (item.kind ? ' (' + item.kind + ')' : ''));
        
        var removeBtn = $('<span class="remove">Ã—</span>');
        removeBtn.click(function(){
            selectedItemsData = selectedItemsData.filter(function(it){ return it.id !== item.id; });
            updateSelectedItemsDisplay();
        });
        
        tag.append(removeBtn);
        display.append(tag);
    });
    
    // hidden í•„ë“œì— JSON ì €ì¥
    $('#selectedItems').val(JSON.stringify(selectedItemsData));
}

// ê¸°ì¡´ ì„ íƒ í’ˆëª© ë¡œë“œ (ìˆ˜ì • ëª¨ë“œ)
function loadSelectedItems(){
    console.log('=== loadSelectedItems ì‹œì‘ ===');
    console.log('ì €ì¥ëœ í’ˆëª© ë°ì´í„° (savedSelectedItems):', savedSelectedItems);
    
    if(savedSelectedItems && Array.isArray(savedSelectedItems) && savedSelectedItems.length > 0){
        selectedItemsData = savedSelectedItems;
        console.log('í’ˆëª© ê°œìˆ˜:', selectedItemsData.length);
        updateSelectedItemsDisplay();
        console.log('í’ˆëª© í‘œì‹œ ì™„ë£Œ');
    } else {
        console.log('ì €ì¥ëœ í’ˆëª©ì´ ì—†ìŠµë‹ˆë‹¤.');
    }
    console.log('=== loadSelectedItems ì¢…ë£Œ ===');
}

// í’ˆëª© ì„ íƒ ëª¨ë‹¬ í‘œì‹œ
function showItemSelectionModal(){
    if (!availableItems || availableItems.length === 0) {
        alert('í’ˆëª© ë°ì´í„°ë¥¼ ë¨¼ì € ë¡œë“œí•´ì£¼ì„¸ìš”.');
        return;
    }
    
    // ì„ì‹œ ì„ íƒ ë°°ì—´
    var tempSelectedItems = selectedItemsData.map(function(item){ return item.id; });
    
    // ëª¨ë‹¬ HTML ìƒì„±
    var modalHtml = '<div class="modal" id="itemSelectionModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 1000;">' +
        '<div class="modal-content" style="background: white; padding: 30px; border-radius: 10px; max-width: 1000px; width: 90%; max-height: 85vh; overflow-y: auto;">' +
        '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">' +
        '<h2 style="margin: 0;">í’ˆëª© ì„ íƒ</h2>' +
        '<div id="selectionCount" style="font-size: 14px; color: #007bff; font-weight: 600;">ì„ íƒ: ' + tempSelectedItems.length + 'ê°œ</div>' +
        '</div>' +
        '<input type="text" id="itemSearchBox" placeholder="í’ˆëª©ëª…ì„ ê²€ìƒ‰í•˜ì„¸ìš”..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 15px;">' +
        '<div style="max-height: 500px; overflow-y: auto; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 15px;">' +
        '<table class="item-table" style="width: 100%; border-collapse: collapse; font-size: 14px;">' +
        '<thead style="background: #4f46e5; position: sticky; top: 0; z-index: 1;">' +
        '<tr>' +
        '<th style="padding: 12px 8px; text-align: center; color: white; width: 5%;">ì„ íƒ</th>' +
        '<th style="padding: 12px 8px; text-align: left; color: white; width: 30%;">í’ˆëª©ëª…</th>' +
        '<th style="padding: 12px 8px; text-align: left; color: white; width: 25%;">ì¢…ë¥˜</th>' +
        '<th style="padding: 12px 8px; text-align: center; color: white; width: 10%;">ë“±ê¸‰</th>' +
        '<th style="padding: 12px 8px; text-align: right; color: white; width: 15%;">ê°€ê²©</th>' +
        '<th style="padding: 12px 8px; text-align: right; color: white; width: 15%;">ë³€ë™</th>' +
        '</tr>' +
        '</thead>' +
        '<tbody id="itemTableBody"></tbody>' +
        '</table>' +
        '</div>' +
        '<div style="display: flex; gap: 10px; justify-content: flex-end;">' +
        '<button type="button" id="closeItemModal" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">ë‹«ê¸°</button>' +
        '<button type="button" id="applyItems" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">ì ìš©</button>' +
        '</div>' +
        '</div>' +
        '</div>';
    
    $('body').append(modalHtml);
    
    // í’ˆëª© ë Œë”ë§ í•¨ìˆ˜
    function renderItems(filterText){
        var tbody = $('#itemTableBody');
        tbody.empty();
        
        var filtered = availableItems.filter(function(item){
            return !filterText || item.title.toLowerCase().includes(filterText.toLowerCase());
        });
        
        if(filtered.length === 0){
            tbody.html('<tr><td colspan="6" style="text-align:center; padding: 20px; color: #999;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>');
            return;
        }
        
        filtered.forEach(function(item){
            var isSelected = tempSelectedItems.indexOf(item.id) > -1;
            var price = parseFloat(item.price) || 0;
            var prevPrice = parseFloat(item.prevDayPrice) || 0;
            
            var changePercent = 0;
            var changeClass = 'price-same';
            var changeSymbol = '';
            
            if(prevPrice > 0){
                changePercent = ((price - prevPrice) / prevPrice * 100).toFixed(2);
                if(changePercent > 0){
                    changeClass = 'price-up';
                    changeSymbol = 'â–²';
                } else if(changePercent < 0){
                    changeClass = 'price-down';
                    changeSymbol = 'â–¼';
                    changePercent = Math.abs(changePercent);
                }
            }
            
            var tr = $('<tr style="cursor: pointer; transition: background 0.2s;"></tr>');
            if(isSelected) tr.addClass('selected').css('background', '#bbdefb');
            
            tr.html(
                '<td style="text-align:center; padding: 10px 8px;">' + (isSelected ? 'âœ“' : '') + '</td>' +
                '<td style="padding: 10px 8px;"><strong>' + (item.title || '-') + '</strong></td>' +
                '<td style="padding: 10px 8px;">' + (item.kind || '-') + '</td>' +
                '<td style="text-align:center; padding: 10px 8px;">' + (item.grade || '-') + '</td>' +
                '<td style="text-align:right; padding: 10px 8px;"><strong>' + price.toLocaleString() + 'ì›</strong></td>' +
                '<td style="text-align:right; padding: 10px 8px;" class="' + changeClass + '">' +
                '<strong>' + changeSymbol + ' ' + Math.abs(changePercent) + '%</strong></td>'
            );
            
            tr.click(function(){
                var index = tempSelectedItems.indexOf(item.id);
                if(index > -1){
                    tempSelectedItems.splice(index, 1);
                    tr.removeClass('selected').css('background', '');
                    tr.find('td:first').text('');
                } else {
                    tempSelectedItems.push(item.id);
                    tr.addClass('selected').css('background', '#bbdefb');
                    tr.find('td:first').text('âœ“');
                }
                $('#selectionCount').text('ì„ íƒ: ' + tempSelectedItems.length + 'ê°œ');
            });
            
            tr.hover(
                function(){ if(!$(this).hasClass('selected')) $(this).css('background', '#f5f5f5'); },
                function(){ if(!$(this).hasClass('selected')) $(this).css('background', ''); }
            );
            
            tbody.append(tr);
        });
    }
    
    // ì´ˆê¸° ë Œë”ë§
    renderItems('');
    
    // ê²€ìƒ‰ ì´ë²¤íŠ¸
    $('#itemSearchBox').on('input', function(){
        renderItems($(this).val());
    });
    
    // ë‹«ê¸° ë²„íŠ¼
    $('#closeItemModal').click(function(){
        $('#itemSelectionModal').remove();
    });
    
    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­
    $('#itemSelectionModal').click(function(e){
        if(e.target.id === 'itemSelectionModal'){
            $(this).remove();
        }
    });
    
    // ì ìš© ë²„íŠ¼
    $('#applyItems').click(function(){
        selectedItemsData = [];
        tempSelectedItems.forEach(function(itemId){
            var item = availableItems.find(function(i){ return i.id === itemId; });
            if(item){
                selectedItemsData.push({
                    id: item.id,
                    title: item.title,
                    kind: item.kind
                });
            }
        });
        updateSelectedItemsDisplay();
        $('#itemSelectionModal').remove();
    });
}
</script>
</body>
</html>
</html>