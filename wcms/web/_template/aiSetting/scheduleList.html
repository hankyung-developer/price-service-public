<!DOCTYPE html>
<html lang="ko">
<head>
    {# head}
    <style>
        /* ìŠ¤ì¼€ì¤„ ì •ë³´ í‘œì‹œ ìŠ¤íƒ€ì¼ ê°œì„  */
        .schedule-info {
            line-height: 1.8;
        }
        .schedule-info > div {
            margin: 3px 0;
        }
        .schedule-info .badge {
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.85em;
        }
        .schedule-info .weekdays {
            font-weight: 600;
            color: #2563eb;
        }
        .schedule-info .red {
            font-weight: 500;
        }
        
        /* ë°ì´í„° ì •ë³´ í‘œì‹œ ìŠ¤íƒ€ì¼ */
        .data-info {
            line-height: 1.8;
            font-size: 0.9em;
        }
        .data-info > div {
            margin: 4px 0;
        }
        .data-info strong {
            color: #374151;
            font-size: 0.9em;
        }
        .data-info .item-count {
            color: #3b82f6;
            font-weight: 600;
        }
        .data-info .item-preview {
            color: #6b7280;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    {# left}
    {# header}

    <main class="container">
        <div role="document">
			<div role="heading">AIê¸°ì‚¬ ìƒì„± ìŠ¤ì¼€ì¥´</div>
			<section class="section-search"> 
                <form role="search" name="searchForm" id="searchForm">
                    <input type="hidden" id="coId" name="coId" value="{_SESSION.coId}"/>

                    <select name="category" id="category">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        {@ result.category.item}
                        <option value="{.category}"{?_GET.category == .category} selected{/}>{.category}</option>
                        {/}
                    </select>
					<div class="search-input">
                        <input type="text" name="searchText" id="searchText" value="{? _GET.searchText}{_GET.searchText}{/}" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                        <button id="searchBtn" class="btn-search" type="button"><i class="fa-light fa-magnifying-glass"></i></button>
                    </div>
					<button type="button" class="btn" id="insertBtn"><i class="fa-light fa-plus"></i> ìŠ¤ì¼€ì¤„ ë“±ë¡</button>
                    <!-- <button type="button" class="btn btn-black" id="deleteBtn">ì‚­ì œ</button> -->
				</form>
			</section>
			<section role="list">
                <div class="list-cont">
                    <table>
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="chkSelectAll"/></th>
                                <th>ëª…ì¹­</th>
                                <th>ë°ì´í„° ì •ë³´</th>
                                <th>ë™ì‘ì‹œê°„</th>
                                <th>ì‚¬ìš©ì—¬ë¶€</th>
                                <th>ìƒì„±ì¼ì</th>
                                <th>ìˆ˜ì •ì¼ì</th>
                            </tr>
                        </thead>
                        <tbody>
                            {@ result.items}
                            <tr data-collection="{.collection}">
                                <td><input type="checkbox" name="apiSelect" value="{.id}"/></td>
                                <td><strong><a href="/aiSetting/scheduleEdit?idx={.idx}" class="title" title="{.title}">{? empty(.title)}<span class="red">ì œëª©ì—†ìŒ</span>{:}{.title}{/}</a></strong></td>
                                <td class="data-info">
                                    {? !empty(.categoryName)}
                                        <div><strong>ğŸ“‚ ì¹´í…Œê³ ë¦¬:</strong> {.categoryName}</div>
                                    {:}
                                        <div><span class="red">âš  ì¹´í…Œê³ ë¦¬ ë¯¸ì„¤ì •</span></div>
                                    {/}
                                    
                                    {? !empty(.selectedItems)}
                                        <div><strong>ğŸ“¦ ì„ íƒ í’ˆëª©:</strong> 
                                            <span class="item-count">{=count(.selectedItems)}ê°œ</span>
                                            <span class="item-preview" title="{? is_array(.selectedItems)}{=implode(', ', array_column(.selectedItems, 'title'))}{/}">
                                                ({? is_array(.selectedItems) && count(.selectedItems) > 0}
                                                    {=.selectedItems[0].title}
                                                    {? count(.selectedItems) > 1} ì™¸ {=count(.selectedItems)-1}ê°œ{/}
                                                {/})
                                            </span>
                                        </div>
                                    {:}
                                        <div><strong>ğŸ“¦ ì„ íƒ í’ˆëª©:</strong> <span style="color: #6b7280;">ìë™ ì„ íƒ</span></div>
                                    {/}
                                    
                                    <div><strong>ğŸ“… ì¡°íšŒ ê¸°ê°„:</strong> 
                                        {? .dataPeriod == '7'}1ì£¼ì¼
                                        {: .dataPeriod == '30'}1ê°œì›”
                                        {: .dataPeriod == '90'}3ê°œì›”
                                        {: .dataPeriod == '180'}6ê°œì›”
                                        {: .dataPeriod == '365'}1ë…„
                                        {:}1ì£¼ì¼{/}
                                    </div>
                                </td>
                                <td class="schedule-info">
                                    {? .scheduleConfig.type == 'daily'}
                                        <span class="badge badge-gray">ë§¤ì¼</span>
                                            {? empty(.scheduleConfig.daily.time)}
                                                <span class="red">âš  ì‹œê°„ ë¯¸ì„¤ì •</span>
                                            {:}
                                                ğŸ• {=.scheduleConfig.daily.time}
                                            {/}
                                    {: .scheduleConfig.type == 'weekly'}
                                        <span class="badge badge-blue">ë§¤ì£¼</span>
                                            {? !empty(.scheduleConfig.weekly.days)}
                                                ğŸ“… <span class="weekdays" data-days="{=implode(',', .scheduleConfig.weekly.days)}">{=implode(',', .scheduleConfig.weekly.days)}</span>
                                            {:}
                                                <span class="red">âš  ìš”ì¼ ë¯¸ì„¤ì •</span>
                                            {/}
                                            {? empty(.scheduleConfig.weekly.time)}
                                                <span class="red">âš  ì‹œê°„ ë¯¸ì„¤ì •</span>
                                            {:}
                                                ğŸ• {=.scheduleConfig.weekly.time}
                                            {/}
                                    {: .scheduleConfig.type == 'monthly'}
                                        <span class="badge badge-green">ë§¤ì›”</span>
                                            {? !empty(.scheduleConfig.monthly.dates)}
                                                ğŸ“… ë§¤ì›” {=implode(', ', .scheduleConfig.monthly.dates)}ì¼
                                            {:}
                                                <span class="red">âš  ë‚ ì§œ ë¯¸ì„¤ì •</span>
                                            {/}
                                            {? empty(.scheduleConfig.monthly.time)}
                                                <span class="red">âš  ì‹œê°„ ë¯¸ì„¤ì •</span>
                                            {:}
                                                ğŸ• {=.scheduleConfig.monthly.time}
                                            {/}
                                    {: .scheduleConfig.type == 'yearly'}
                                        <span class="badge badge-purple">ë§¤ë…„</span>
                                            {? !empty(.scheduleConfig.yearly.months)}
                                                ğŸ“… {=implode(', ', .scheduleConfig.yearly.months)}ì›”
                                                {? !empty(.scheduleConfig.yearly.dates)}
                                                    {=implode(', ', .scheduleConfig.yearly.dates)}ì¼
                                                {:}
                                                    <span class="red">âš  ì¼ ë¯¸ì„¤ì •</span>
                                                {/}
                                            {:}
                                                <span class="red">âš  ì›” ë¯¸ì„¤ì •</span>
                                            {/}
                                            {? empty(.scheduleConfig.yearly.time)}
                                                <span class="red">âš  ì‹œê°„ ë¯¸ì„¤ì •</span>
                                            {:}
                                                ğŸ• {=.scheduleConfig.yearly.time}
                                            {/}
                                    {:}
                                        <span class="red">âš  ìŠ¤ì¼€ì¤„ ì •ë³´ì—†ìŒ</span>
                                    {/}
                                </td>
                                <td>{? .isUse}<span style="color: green;">âœ“ ì‚¬ìš©</span>{:}<span style="color: gray;">âœ• ë¯¸ì‚¬ìš©</span>{/}</td>
                                <td>{=substr(.insert.date,0,10)}<br/><small>({.insert.managerName})</small></td>
                                <td>{=substr(.update.date,0,10)}<br/><small>({.update.managerName})</small></td>
                            </tr>
                            {/}
                        </tbody>
                    </table>
                </div>
                {#paging}
            </section>
        </div>
    </main>

<!-- ë§ˆì§€ë§‰ ë°ì´í„° Modal -->
<dialog id="dataModal">
    <article style="width:600px;">
        <header>
            <a href="#close" aria-label="Close" class="close" data-target="dataModal" onClick="toggleModal(event);"></a>
            <h6>ì œëª©</h6>
        </header>
        <div style="height:400px;overflow-y:scroll;">
            <table id="dataTable1" class="th-bg">
                <thead><tr></tr></thead>
                <tbody></tbody>
            </table>
        </div>
        <footer>
            <a href="#cancel" role="button" data-target="dataModal" onClick="toggleModal(event);"> ë‹«ê¸°</a>
          </footer>
    </article>
</dialog>

<script type="text/javascript">
    /**
     * ìš”ì¼ ìˆ«ìë¥¼ í•œê¸€ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
     * @param {string|number} dayNum - ìš”ì¼ ìˆ«ì (0=ì¼ìš”ì¼, 1=ì›”ìš”ì¼, ..., 6=í† ìš”ì¼)
     * @returns {string} í•œê¸€ ìš”ì¼
     */
    function convertDayToKorean(dayNum) {
        const days = {
            '0': 'ì¼',
            '1': 'ì›”',
            '2': 'í™”',
            '3': 'ìˆ˜',
            '4': 'ëª©',
            '5': 'ê¸ˆ',
            '6': 'í† '
        };
        return days[String(dayNum)] || dayNum;
    }

    /**
     * í˜ì´ì§€ ë¡œë“œ ì‹œ ëª¨ë“  ìš”ì¼ ìˆ«ìë¥¼ í•œê¸€ë¡œ ë³€í™˜
     */
    function convertWeekdaysToKorean() {
        $('.weekdays').each(function() {
            const daysData = $(this).attr('data-days');
            if (daysData) {
                // ì½¤ë§ˆë¡œ êµ¬ë¶„ëœ ìš”ì¼ ìˆ«ìë¥¼ ë°°ì—´ë¡œ ë³€í™˜
                const dayNumbers = daysData.split(',').map(d => d.trim());
                // ê° ìˆ«ìë¥¼ í•œê¸€ ìš”ì¼ë¡œ ë³€í™˜
                const koreanDays = dayNumbers.map(convertDayToKorean);
                // ë³€í™˜ëœ ìš”ì¼ì„ í‘œì‹œ (ì˜ˆ: ì›”, í™”, ìˆ˜, ëª©, ê¸ˆ)
                $(this).text(koreanDays.join(', '));
            }
        });
    }

    $(document).ready(function(){
        // ìš”ì¼ ìˆ«ìë¥¼ í•œê¸€ë¡œ ë³€í™˜
        convertWeekdaysToKorean();

        $('#insertBtn').click(function(){
            location.href='/aiSetting/scheduleEdit';
        });
    
        $('#deleteBtn').click(function(){
            var chkCompany = '';
            $("input[name=apiSelect]:checked").each(function(){
                chkCompany += $(this).val() + '|';
            });
    
            if(chkCompany == '' ){
                alert('Please select the api information to be deleted.');
            }else{
                apiDelete(chkCompany);
            }
        });
    
        $('#chkSelectAll').click(function(){
            $("input[name=apiSelect]").prop('checked', $("input:checkbox[id='chkSelectAll']").is(":checked"));
        });
            
        $('#searchBtn').click(function(){
            $('#searchForm').attr('action','/aiSetting/scheduleList').submit();
        });
    });
    </script>
</body>
</html>