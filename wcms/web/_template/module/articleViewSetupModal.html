<!-- articleView Setup Modal -->
<dialog id="articleViewModal">
	<article class="card card-sm">
        <header class="flex nowrap justify-between align-center mr-0">
			<h6></h6>
            <a href="#close" aria-label="Close" title="닫기" data-target="articleViewModal" onclick="toggleModal(event)"><i class="fa-light fa-circle-xmark fa-lg"></i></a>
        </header>
		<!-- layoutInput -->
		<div class="layoutInput">
			<input type="hidden" id="objId">
			<div class="row">
				<span class="label">제목</span>
				<input type="text" id="title" placeholder="화면에 표출될 박스 명입니다." />
			</div>
			<div class="row">
				<span class="label">custom boxId</span>
				<input type="text" id="customBoxId" placeholder="사용자 지정 boxId (옵션)" />
			</div>
			<div class="row">
				<span class="label">종류</span>
				<select class="select2" id="articleViewType">
					<option value="title">제목</option>
					<option value="content">본문</option>
					<option value="reporter">기자</option>
					<option value="relation">관련기사</option>
					<option value="comment">댓글</option>
				</select>
			</div>
			<div class="grid">
				<div class="group">
					<div class="label">PC설정</div>
					<div class="row">
						<span class="label">노출</span>
						<input type="checkbox" role="switch" class="" id="showpc" data-on="ON" data-off="OFF" checked/>
						<span class="switch-label">ON</span>
					</div>
					<div class="row">
						<span class="label">PC Skin</span>
						<select class="select2" id="pcSkin">
							<option value="">안보이기</option>
						</select>
					</div>
					<div class="row" style="height: 200px;max-height: 200px;justify-content: center;">
						<img id="pcSkinPreview" src="" onError="this.src='/img/skin/show-hidden-icons.png';" style="width: auto;height: auto;max-width: 100%;max-height: 200px;">
					</div>
				</div>
				<div class="group">
					<div class="label">MOBILE설정</div>
					<div class="row">
						<span class="label">노출</span>
						<input type="checkbox" role="switch" class="" id="showmobile" data-on="ON" data-off="OFF" checked/>
						<span class="switch-label">ON</span>
					</div>
					<div class="row">
						<span class="label">MOBILE Skin</span>
						<select class="select2" id="mobileSkin">
							<option value="">안보이기</option>
						</select>
					</div>
					<div class="row" style="height: 200px;max-height: 200px;justify-content: center;">
						<img id="mobileSkinPreview" src="" onError="this.src='/img/skin/show-hidden-icons.png';" style="width: auto;height: auto;max-width: 100%;max-height: 200px;">
					</div>
				</div>
			</div>
		</div>
		<!--// layoutInput -->
		<footer class="flex justify-end">
			<button type="button" class="btn btn-md"  id="btn_articleViewObjSetup">저장</button>
			<button type="button" class="btn btn-md btn-gray"  data-target="articleViewModal" onclick="toggleModal(event);">취소</button>
		</footer>
	</article>
</dialog>
<!-- //articleView Setup Modal -->


<script>
/*******************************************************************************
 * 기사뷰 박스 설정
 */

// 기사뷰 영역 세팅 모달창
$('#layoutBase').on("click",".articleViewMoreBt",function(){
	var obj=$(this).closest('.object');

	var modal = $('#articleViewModal');
	openModal(document.getElementById('articleViewModal'));

	// skin select 로딩
	setSelectSkin(modal.find('select#pcSkin'), $(this).closest('[data-dinnum]').data('dinnum'), 'pc', obj.attr('data-objecttype'));
	setSelectSkin(modal.find('select#mobileSkin'), $(this).closest('[data-dinnum]').data('dinnum'), 'mobile', obj.attr('data-objecttype'));

	modal.find('article.card').attr('data-objectType',obj.attr('data-objectType'));
	modal.find('header h6').html((obj.attr('data-title')?obj.attr('data-title'):'기사뷰')+' <small>(objId : '+obj.attr('data-objid')+')</small>');
	modal.find('#objId').val(obj.attr('data-objid'));
	modal.find('#title').val(obj.attr('data-title'));
	modal.find('#customBoxId').val(obj.attr('data-customboxid'));
	modal.find('#showpc').prop('checked',obj.attr('data-showpc')=="N"?false:true);
	modal.find('#showmobile').prop('checked',obj.attr('data-showmobile')=="N"?false:true);
	modal.find('#pcSkin').val(obj.attr('data-pcskin'));
	modal.find('#mobileSkin').val(obj.attr('data-mobileskin'));
	modal.find('#articleViewType').val(obj.attr('data-articleViewType'));

	modal.find('#pcSkin').select2({dropdownParent: modal});
	modal.find('#mobileSkin').select2({dropdownParent: modal});
	modal.find('#articleViewType').select2({dropdownParent: modal});

	// 각각의 체크박스에 대해 초기값 설정
	$('input[role="switch"]').each(function(){
		var checked = $(this).prop('checked');
		var row = $(this).closest('.row');
		var on = $(this).data('on');
		var off = $(this).data('off');
		if (checked) {
			row.find('.switch-label').empty().append(on);
		} else {
			row.find('.switch-label').empty().append(off);
		}
	});

	setPreview(modal);
});

// 기사뷰 세팅사항 저장
$('#articleViewModal').on('click','#btn_articleViewObjSetup',function(e){
	let modal = $(this).closest('#articleViewModal');

	let dataObject = new Object();
	dataObject['objId'] = modal.find("#objId").val();
	dataObject['title'] = modal.find('#title').val();
	dataObject['customBoxId'] = modal.find('#customBoxId').val();
	dataObject['showPC'] = modal.find('#showpc').prop('checked')?"Y":"N";
	dataObject['showMobile'] = modal.find('#showmobile').prop('checked')?"Y":"N";
	dataObject['pcSkin'] = modal.find('#pcSkin').val();
	dataObject['mobileSkin'] = modal.find('#mobileSkin').val();
	dataObject['articleViewType'] = modal.find('#articleViewType').val();
	
	let selectBox = $('[data-objId="'+dataObject['objId']+'"]');
	selectBox.find('header > h6').text(dataObject['title']);
	for (const [key, value] of Object.entries(dataObject)) {
		selectBox.attr('data-'+key.toLowerCase() , value);
	}

	dataObject['pageId'] = $("#layoutSelect").val();
	
	$.ajax({
		url: '/layout/boxSave/ajax',
		type: 'POST',
		data: JSON.stringify(dataObject),
		dataType: "json",
		success: function (data) {
			alert('저장완료');
			closeModal(document.getElementById('articleViewModal'));
		},
		error: function (){
			alert('저장 시 오류가 발생했습니다.\n다시 저장을 해주세요.\n계속해서 오류가 발생되면 관리자에게 연락해주세요');
			closeModal(document.getElementById('articleViewModal'));
		}
	});
});

// skin 선택시 처리
$("#articleViewModal #pcSkin").on('change',function(e,active){
	var modal = $('#articleViewModal');
	setPreview(modal);
	// if($(this).val()){
	// 	var json = modal.find('#pcSkin option:selected').data('json');
	// }
});
$("#articleViewModal #mobileSkin").on('change',function(e,active){
	var modal = $('#articleViewModal');
	setPreview(modal);
	// if($(this).val()){
	// 	var json = modal.find('#mobileSkin option:selected').data('json');
	// }
});
</script>