
<!-- Banner Setup Modal -->
<dialog id="bannerModal">
    <article class="card card-sm">
		<header class="flex nowrap justify-between align-center mr-0">
			<h6></h6>
            <a href="#close" aria-label="Close" title="닫기" data-target="bannerModal" onclick="toggleModal(event)"><i class="fa-light fa-circle-xmark fa-lg"></i></a>
        </header>
		<!-- layoutInput -->
		<div class="layoutInput">
			<input type="hidden" id="objId">
			<div class="row">
				<span class="label">제목</span>
				<input type="text" id="title" placeholder="화면에 표출될 박스 명입니다." />
			</div>
			<div class="row">
				<span class="label">custom boxId</span>
				<input type="text" id="customBoxId" placeholder="사용자 지정 boxId (옵션)" />
			</div>
			<div class="row">
				<span class="label">배너종류</span>
				<select id="bannerKind">
					<option value="one">최신1개</option>
					<option value="stack">나열</option>
					<option value="slideRight">우 슬라이드</option>
					<option value="random">랜덤</option>
				</select>
			</div>
			<div class="row">
				<span class="label">슬라이드 시간</span>
				<input type="text" id="slideTime" placeholder="슬라이드 정지시간(초)" />
			</div>
			<div class="row">
				<span class="label">노출옵션</span>
				<select id="showOption">
					<option value="">미사용</option>
					<option value="list">리스트</option>
					<option value="view">뷰</option>
				</select>
			</div>
			<div class="row">
				<span class="label">노출옵션 - 리스트/본문 위치</span>
				<input type="text" id="showPosition" placeholder="위치 (숫자)" />
			</div>
			<div class="row">
				<span class="label">노출옵션 - 카테고리</span>
				<select class="select2" id="showCategory" data-placeholder="카테고리 선택"  multiple="multiple" style="width:100%;">
					<option value="{_SESSION.coId}000000000">전체</option>
					{@ result.categoryList}
						{? .isUse && .isNews}
					<option class="level-{.depth}" value="{.id}" style='{?.depth==1}font-weight: 600;{/}'>{? .depth==2}&nbsp;&nbsp;&nbsp;&nbsp;{: .depth==3}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{/}{.name}</option>
						{/}
					{/}
				</select>
			</div>
			<div class="grid grid1-2">
				<div>
					<div class="row">
						<span class="label">PC노출</span>
						<input type="checkbox" role="switch" class="" id="showpc" data-on="ON" data-off="OFF" checked/>
						<span class="switch-label">ON</span>
					</div>
					<div class="row">
						<span class="label">PC Skin</span>
						<select class="select2" id="pcSkin">
							<option value="">기본</option>
						</select>
					</div>
				</div>
				<div>
					<div class="row" style="height: 200px;max-height: 200px;justify-content: center;">
						<img id="pcSkinPreview" src="" onError="this.src='/img/skin/show-hidden-icons.png';" style="width: auto;height: auto;max-width: 100%;max-height: 200px;">
					</div>
				</div>
			</div>

			<div class="grid grid1-2">
				<div>

					<div class="row">
						<span class="label">MOBILE노출</span>
						<input type="checkbox" role="switch" class="" id="showmobile" data-on="ON" data-off="OFF" checked/>
						<span class="switch-label">ON</span>
					</div>
					<div class="row">
						<span class="label">MOBILE Skin</span>
						<select class="select2" id="mobileSkin">
							<option value="">기본</option>
						</select>
					</div>
				</div>
				<div>
					<div class="row" style="height: 200px;max-height: 200px;justify-content: center;">
						<img id="mobileSkinPreview" src="" onError="this.src='/img/skin/show-hidden-icons.png';" style="width: auto;height: auto;max-width: 100%;max-height: 200px;">
					</div>
				</div>
			</div>
		</div>
		<!--// layoutInput -->
		<footer class="flex justify-end">
			<button type="button" class="btn btn-md"  id="btn_bannerObjSetup">저장</button>
			<button type="button" class="btn btn-md btn-gray"  data-target="bannerModal" onclick="toggleModal(event);">취소</button>
		</footer>
	</article>
</dialog>
<!-- //Banner Setup Modal -->

<script>
	/*******************************************************************************
	 * 배너 박스 설정
	 */

	//배너 영역 세팅 모달창
	$('#layoutBase').on("click",".bannerMoreBt",function(){
		var obj=$(this).closest('.object');
		var objId=obj.attr('data-objid');
		var title=obj.attr('data-title');

		var modal = $('#bannerModal');
		openModal(document.getElementById('bannerModal'));
		
		// skin select 로딩
		setSelectSkin(modal.find('select#pcSkin'), $(this).closest('[data-dinnum]').data('dinnum'), 'pc', obj.attr('data-objectType'));
		setSelectSkin(modal.find('select#mobileSkin'), $(this).closest('[data-dinnum]').data('dinnum'), 'mobile', obj.attr('data-objectType'));

		modal.find('article.card').attr('data-objectType',obj.attr('data-objectType'));
		modal.find('header h6').html((title?title:'광고')+' <small>(objId : '+objId+')</small>');
		modal.find('#objId').val(objId);
		modal.find('#title').val(title);
		modal.find('#customBoxId').val(obj.attr('data-customboxid'));
		modal.find('#bannerKind').val(!!obj.attr('data-bannerKind')?obj.attr('data-bannerKind'):'one');
		modal.find('#slideTime').val(obj.attr('data-slidetime'));
		modal.find('#showOption').val(obj.attr('data-showoption'));
		modal.find('#showPosition').val(obj.attr('data-showposition'));
		modal.find('#showCategory').val(!!obj.attr('data-showcategory')?obj.attr('data-showcategory').split(','):[]);
		modal.find('#showpc').prop('checked',obj.attr('data-showpc')=="N"?false:true);
		modal.find('#showmobile').prop('checked',obj.attr('data-showmobile')=="N"?false:true);
		modal.find('#pcSkin').val(obj.attr('data-pcskin'));
		modal.find('#mobileSkin').val(obj.attr('data-mobileskin'));

		modal.find('#bannerKind').select2({dropdownParent: modal});
		modal.find('#showOption').select2({dropdownParent: modal});
		modal.find('#showCategory').select2({dropdownParent: modal});

		// 각각의 체크박스에 대해 초기값 설정
		$('input[role="switch"]').each(function(){
			var checked = $(this).prop('checked');
			var row = $(this).closest('.row');
			var on = $(this).data('on');
			var off = $(this).data('off');

			if (checked) {
				row.find('.switch-label').empty().append(on);
			} else {
				row.find('.switch-label').empty().append(off);
			}
		});
		setPreview(modal);
		changeShowOption(modal);
	});

	/**
	 * 배너 세팅사항 저장
	 */
	$('#bannerModal').on('click','#btn_bannerObjSetup',function(e){
		let modal = $(this).closest('#bannerModal');

		let dataObject = new Object();
		dataObject['objId'] = modal.find("#objId").val();
		dataObject['title'] = modal.find('#title').val();
		dataObject['customBoxId'] = modal.find('#customBoxId').val();
		dataObject['bannerKind'] = modal.find("#bannerKind").val();
		dataObject['slideTime'] = modal.find('#slideTime').val();
		dataObject['showOption'] = modal.find('#showOption').val();
		dataObject['showPosition'] = modal.find('#showPosition').val();
		dataObject['showCategory'] = modal.find('#showCategory').val().toString();
		dataObject['showPC'] = modal.find('#showpc').prop('checked')?"Y":"N";
		dataObject['showMobile'] = modal.find('#showmobile').prop('checked')?"Y":"N";
		dataObject['pcSkin'] = modal.find('#pcSkin').val();
		dataObject['mobileSkin'] = modal.find('#mobileSkin').val();

		let selectBox = $('[data-objId="'+dataObject['objId']+'"]');
		selectBox.find('header h6').text(dataObject['title']);
		for (const [key, value] of Object.entries(dataObject)) {
			selectBox.attr('data-'+key.toLowerCase() , value);
		}

		dataObject['pageId'] = $("#layoutSelect").val();

		$.ajax({
			url: '/layout/boxSave/ajax',
			type: 'POST',
			data: JSON.stringify(dataObject),
			dataType: "json",
			success: function (data) {
				alert('저장완료');
			},
			error: function (){
				alert('저장 시 오류가 발생했습니다.\n다시 저장을 해주세요.\n계속해서 오류가 발생되면 관리자에게 연락해주세요');
			}
		});

		closeModal(document.getElementById('bannerModal'));
	});

	// skin 선택시 처리
	$("#bannerModal #pcSkin").on('change',function(e,active){
		let modal = $('#bannerModal');
		setPreview(modal);
	});

	$("#bannerModal #mobileSkin").on('change',function(e,active){
		let modal = $('#bannerModal');
		setPreview(modal);
	});

	// 노출옵션 변경
	$("#bannerModal #showOption").on('change',function(e,active){
		let modal = $('#bannerModal');
		changeShowOption(modal);
	});
	function changeShowOption(modal)
	{
		let showOption = modal.find('#showOption').val();
		if (showOption == 'list') {
			modal.find('#showPosition').closest('.row').show();
			modal.find('#showCategory').closest('.row').show();
		} else if (showOption == 'view') {
			modal.find('#showPosition').closest('.row').show();
			modal.find('#showCategory').closest('.row').hide();
		} else {
			modal.find('#showPosition').closest('.row').hide();
			modal.find('#showCategory').closest('.row').hide();
		}
	}
</script>